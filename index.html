<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>Dongyang Fan</title>

    <meta name="author" content="Dongyang Fan">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="images/favicon/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    
  </head>

  <body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
      <span id="themeIcon">üåô</span>
    </button>
    
    <table style="width:100%;max-width:800px;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;"><tbody>
      <tr style="padding:0px">
        <td style="padding:0px">
          <table style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;"><tbody>
            <tr style="padding:0px">
              <td style="padding:2.5%;width:63%;vertical-align:middle">
                <p class="name" style="text-align: center;">
                  Dongyang Fan
                </p>
                <p>Hi! Thanks for stopping by :) I'm a passionate 4th-year PhD student at <a href="https://www.epfl.ch/labs/mlo/">Machine Learning and Optimization Lab</a> at EPFL, supervised by <a href="https://scholar.google.com/citations?user=r1TJBr8AAAAJ&hl=en">Prof. Martin Jaggi</a>. My name is pronounced as Don-Young.
                </p>
                <p>
                My research interests include:

                <ul> <li> <strong>Data-Efficient Language Modeling</strong> <ul> 
                  <li>Mixture-of-Experts architectures</li>
                   <li>Decentralized training methods</li> 
                   <li>Accelerating LLM pretraining through metadata conditioning</li> 
                  
                  </ul> </li> <li> <strong>Responsible Language Modeling</strong> <ul> 
                    <li>Data-compliant pretraining by respecting owners‚Äô opt-out choices.</li> 
                    <li>Designing compensation frameworks for data contributors</li> <li>Understanding and mitigating model hallucinations</li> </ul> </li> </ul>

                  </ul>

                  I am also happy to branch out my research. If you want to reach out, do not hesitate to drop me an email!
                  
                </p>
                <p style="text-align:center">
                  <a href="mailto:dongyang.fan@epfl.ch">Email</a> &nbsp;/&nbsp;
                  <!-- <a href="https://drive.google.com/file/d/1J-jg1cLd7D1rCXRqkbjhes2PBSlX4Ofy/view?usp=sharing">CV</a> &nbsp;/&nbsp; -->
                  <a href="https://scholar.google.com/citations?user=U7yzfCkAAAAJ&hl=en">Google Scholar</a> &nbsp;/&nbsp;
                   <a href="https://www.semanticscholar.org/author/Dongyang-Fan/2284762232"> Semantic Scholar</a> &nbsp;/&nbsp;
                  <a href="https://x.com/dyfan22">Twitter</a> &nbsp;/&nbsp;
                  <a href="https://github.com/fan1dy/">Github</a> &nbsp;/&nbsp;
                  <a href="https://www.linkedin.com/in/fannnndy/">LinkedIn</a>
                </p>
              </td>
              <td style="padding:2.5%;width:37%;max-width:37%">
                <a href="images/IMG_2469.png"><img style="width:100%;max-width:100%;object-fit: cover; border-radius: 50%;" alt="profile photo" src="images/IMG_2469.png" class="hoverZoomLink"></a>
              </td>
            </tr>
          </tbody></table>
         

          <table style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;"><tbody>
              <tr>
              <td style="padding:16px;width:100%;vertical-align:middle">
                <h2>Research</h2>
                <p style="font-size: 11px; color: var(--text-color); opacity: 0.7; margin-top: 4px;">
                  <em>Note: WS denotes Workshop</em>
                </p>
              </td>
            </tr>
          </tbody></table>
          <table style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;"><tbody>

           <tr bgcolor="#ffffd0">
              <td style="padding:16px;width:20%;vertical-align:middle">
                <div class="conference-container">
                  <span class="conference-tag">preprint 2025</span>
                </div>
                <!-- <div class="one"> -->
                  <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
                  <img src='images/beyond_urls.png' width="160">
                </div>
              </td>
              <td style="padding:8px;width:80%;vertical-align:middle">
              <span class="papertitle">Beyond URLs: Metadata Diversity and Position for Efficient LLM Pretraining
        </span>
                </a>
                <br>
                <strong>Dongyang Fan*</strong>,
                Diba Hashemi*,
                <a href="https://spkreddy.org/">Sai Praneeth Karimireddy</a>,
                Martin Jaggi
                <br>
                <a href="https://arxiv.org/abs/2511.21613">arXiv</a>
                <div class="keywords">
                  <span class="keyword-tag">LLM Pretraining</span>
                  <span class="keyword-tag">Metadata</span>
                  <span class="keyword-tag">Data Efficiency</span>
                </div>
                <p></p>
                <!-- <p>
                  <li>We introduce the concept of Data Compliance Gap (DCG), to quantify the performance difference due to ethical compliance  </li>
                  <li>We demonstrate that DCG is close to 0% for general knowledge acquisition, however, compliance gap exists in knowledge of veracity and in structural formats. 
                    </li>
                  <li>A noticeable DCG also exists for non-compliant medical domain data.</li>
                </p> -->
              </td>
            </tr>



            <tr >
              <td style="padding:16px;width:20%;vertical-align:middle;">
                <div class="conference-container">
                  <span class="conference-tag">preprint 2025</span>
                </div>
                <!-- <div class="one"> -->
                <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
                  <img src='images/apertus.jpg' width="160">
                </div>
              </td>
              <td style="padding:8px;width:80%;vertical-align:middle">
              <span class="papertitle">Apertus: Democratizing Open and Compliant LLMs for Global Language Environments
        </span>
                </a>
                <br>
                Apertus team (as a member of the pretraining team)
                <br>
                <a href="https://arxiv.org/abs/2509.14233">arXiv</a>
                <div class="keywords">
                  <span class="keyword-tag">Open LLMs</span>
                  <span class="keyword-tag">Data Compliance</span>
                  <span class="keyword-tag">Multilingual</span>
                </div>
                <p></p>
                <!-- <p>
                  <li>Data are important for LLMs and they are of different intrinsic costs</li>
                  <li>Applying popular data valuation methods as pricing rules may encourage data sellers to misreport their true costs </li>
                  <li>We revisit classical truthful methods from the game theory literature</li>
                </p> -->
              </td>
            </tr>

          <tr bgcolor="#ffffd0">
              <td style="padding:16px;width:20%;vertical-align:middle">
                <div class="conference-container">
                  <span class="conference-tag">COLM 2025 WS (oral üèÜ)</span>
                </div>
                <!-- <div class="one"> -->
                  <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
                  <img src='images/timoe.jpg' width="160">
                </div>
              </td>
              <td style="padding:8px;width:80%;vertical-align:middle">
              <span class="papertitle">TiMoE: Time-Aware Mixture of Language Experts
        </span>
                </a>
                <br>
                Robin Faro*,
                <strong>Dongyang Fan*</strong>,
                Tamar Alphaidze, 
                Martin Jaggi
                <br>
                <a href="https://arxiv.org/abs/2508.08827">arXiv</a>
                /
                <a href="https://github.com/epfml/TiMoE">codes</a>
                /
                <a href="https://drive.google.com/file/d/1VYjrKzpk2gJ4tLB3LrWgir8FG1qPMZyA/view?usp=sharing">slides</a>
                <div class="keywords">
                  <span class="keyword-tag">Mixture-of-Experts</span>
                  <span class="keyword-tag">Temporal Modeling</span>
                  <span class="keyword-tag">LLM Architecture</span>
                </div>
                <p></p>
                <!-- <p>
                  <li>We introduce the concept of Data Compliance Gap (DCG), to quantify the performance difference due to ethical compliance  </li>
                  <li>We demonstrate that DCG is close to 0% for general knowledge acquisition, however, compliance gap exists in knowledge of veracity and in structural formats. 
                    </li>
                  <li>A noticeable DCG also exists for non-compliant medical domain data.</li>
                </p> -->
              </td>
            </tr>




            <tr >
              <td style="padding:16px;width:20%;vertical-align:middle;">
                <div class="conference-container">
                  <span class="conference-tag">NeurIPS 2025</span>
                </div>
                <!-- <div class="one"> -->
                <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
                  <img src='images/context-diagram.png' width="160">
                </div>
              </td>
              <td style="padding:8px;width:80%;vertical-align:middle">
              <span class="papertitle">URLs Help, Topics Guide: Understanding Metadata Utility in LLM Training
        </span>
                </a>
                <br>
                <strong>Dongyang Fan</strong>,
                Vinko Sabolƒçec, 
                Martin Jaggi,
                <br>
                <a href="https://www.arxiv.org/abs/2505.16570">arXiv</a> /
                <a href="https://github.com/fan1dy/metadata-enhanced-pretrain-datapipeline">codes</a>
                <div class="keywords">
                  <span class="keyword-tag">LLM Training</span>
                  <span class="keyword-tag">Metadata</span>
                  <span class="keyword-tag">Data Efficiency</span>
                  <span class="keyword-tag">Steering</span>
                </div>
                <p></p>
                <!-- <p>
                  <li>Data are important for LLMs and they are of different intrinsic costs</li>
                  <li>Applying popular data valuation methods as pricing rules may encourage data sellers to misreport their true costs </li>
                  <li>We revisit classical truthful methods from the game theory literature</li>
                </p> -->
              </td>
            </tr>
    
            <tr bgcolor="#ffffd0">
              <td style="padding:16px;width:20%;vertical-align:middle">
                <div class="conference-container">
                  <span class="conference-tag">COLM 2025 (oral üèÜ)</span>
                </div>
                <!-- <div class="one"> -->
                  <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
                  <img src='images/robots_history-1.png' width="160">
                </div>
              </td>
              <td style="padding:8px;width:80%;vertical-align:middle">
              <span class="papertitle">Can Performant LLMs Be Ethical? Quantifying the Impact of Web Crawling Opt-Outs
        </span>
                </a>
                <br>
                <strong>Dongyang Fan</strong>,
                Vinko Sabolƒçec, 
                Matin Ansaripour, 
                <a href="https://ayushkumartarun.github.io/">Ayush Kumar Tarun</a>, 
                Martin Jaggi, 
                <a href="https://atcbosselut.github.io/">Antoine Bosselut</a>,
                <a href="https://scholar.google.ch/citations?user=nFQJEskAAAAJ&hl=en">Imanol Schlag</a>
                <br>
                <a href="https://arxiv.org/abs/2504.06219">arXiv</a>
                /
                <a href="https://github.com/swiss-ai/robots-txt-compliance">codes</a>
                /
                <a href="https://data-compliance.github.io/">project page</a> 
                /
                <a href="https://drive.google.com/file/d/1Aj326KilI8yzK5nULQXbecHuMWEGvhnn/view?usp=sharing">slides</a>
                <div class="keywords">
                  <span class="keyword-tag">Data Compliance</span>
                  <span class="keyword-tag">Ethics</span>
                  <span class="keyword-tag">Memorization</span>
                  <span class="keyword-tag">Responsible AI</span>
                </div>
                <p></p>
                <!-- <p>
                  <li>We introduce the concept of Data Compliance Gap (DCG), to quantify the performance difference due to ethical compliance  </li>
                  <li>We demonstrate that DCG is close to 0% for general knowledge acquisition, however, compliance gap exists in knowledge of veracity and in structural formats. 
                    </li>
                  <li>A noticeable DCG also exists for non-compliant medical domain data.</li>
                </p> -->
              </td>
            </tr>


            <tr >
              <td style="padding:16px;width:20%;vertical-align:middle">
                <div class="conference-container">
                  <span class="conference-tag">ICLR WS 2025</span>
                </div>
                <!-- <div class="one"> -->
                  <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
                  <img src='images/data_market.png' width="160">
                </div>
              </td>
              <td style="padding:8px;width:80%;vertical-align:middle">
              <span class="papertitle">Do Data Valuations Make Good Data Prices?
        </span>
                </a>
                <br>
                <strong>Dongyang Fan</strong>,
                Tyler J. Rotello, 
                <a href="https://spkreddy.org/">Sai Praneeth Karimireddy</a>
                <br>
                <a href="https://arxiv.org/abs/2504.05563">arXiv</a>
                <div class="keywords">
                  <span class="keyword-tag">Data Valuation</span>
                  <span class="keyword-tag">Game Theory</span>
                  <span class="keyword-tag">Data Markets</span>
                </div>
                <p></p>
                <!-- <p>
                  <li>Data are important for LLMs and they are of different intrinsic costs</li>
                  <li>Applying popular data valuation methods as pricing rules may encourage data sellers to misreport their true costs </li>
                  <li>We revisit classical truthful methods from the game theory literature</li>
                </p> -->
              </td>
            </tr>



    <tr onmouseout="cat4d_stop()" onmouseover="cat4d_start()" bgcolor="#ffffd0">
      <td style="padding:16px;width:20%;vertical-align:middle">
        <div class="conference-container">
          <span class="conference-tag">ICML 2025</span>
        </div>
        <!-- <div class="one"> -->
          <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
          <img src='images/comigs.png' width="160">
        </div>
      </td>
      <td style="padding:8px;width:80%;vertical-align:middle">
			<span class="papertitle">On-Device Collaborative Language Modeling via a Mixture of Generalists and Specialists
</span>
        </a>
        <br>
				<strong>Dongyang Fan*</strong>,
				<a href="https://beme248.github.io/profile/">Bettina Messmer*</a>,
        <a href="https://doikov.com/">Nikita Doikov</a>,
        Martin Jaggi
        <br>
        <a href="https://github.com/epfml/CoMiGS/tree/main">codes</a>
        /
        <a href="https://arxiv.org/abs/2409.13931">arXiv</a>
        <div class="keywords">
          <span class="keyword-tag">Collaborative Learning</span>
          <span class="keyword-tag">Mixture-of-Experts</span>
          <span class="keyword-tag">On-Device</span>
          <span class="keyword-tag">Federated Learning</span>
        </div>
        <p></p>
        <!-- <p>
          <li>We propose a novel collaborative language modeling framework -- CoMiGS </li>
          <li>Our bi-level reformulation of MoE objectives efficiently achieves token-level personalization</li>
          <li>Our method enjoys convergence guarantee and demonstrates strong empirical performances</li>
        </p> -->
      </td>
    </tr>


    <tr onmouseout="ever_stop()" onmouseover="ever_start()">
      <td style="padding:16px;width:20%;vertical-align:middle">
        <div class="conference-container">
          <span class="conference-tag">ICLR WS 2024</span>
        </div>
        <!-- <div class="one"> -->
           <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
          <img src='images/moe_design_choice.png' width=100%>
        </div>
      </td>
      <td style="padding:8px;width:80%;vertical-align:middle">
			<span class="papertitle">Towards an empirical understanding of MoE design choices
</span>
        </a>
        <br>
        <strong>Dongyang Fan*</strong>,
				<a href="https://beme248.github.io/profile/">Bettina Messmer*</a>,
        Martin Jaggi
				<br>
        <a href="https://arxiv.org/abs/2402.13089">arXiv</a>
        <div class="keywords">
          <span class="keyword-tag">Mixture-of-Experts</span>
          <span class="keyword-tag">Architecture Design</span>
          <span class="keyword-tag">Expert Specialization</span>
        </div>
        <p></p>
        <!-- <p>
          <li>We ablate the design choices of Mixture-of-Experts models </li>
          <li>Preferred design choices differ when routing at a token or sequence level </li>
          <li>Weak topic specialization can stem from sequence-level routing</li>
        </p> -->
      </td>
    </tr>


    <tr bgcolor="#ffffd0">
      <td style="padding:16px;width:20%;vertical-align:middle">
        <div class="conference-container">
          <span class="conference-tag">COLM 2024</span>
        </div>
        <!-- <div class="one"> -->
          <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
          <img src='images/pcl.png' width="160">
        </div>
      </td>
      <td style="padding:8px;width:80%;vertical-align:middle">
			<span class="papertitle">Personalized Collaborative Fine-Tuning for On-Device Large Language Models
</span>
        </a>
        <br>
				Nicolas Wagner,
				<strong>Dongyang Fan</strong>,
        Martin Jaggi

        <br>
        <a href="https://github.com/epfml/personalized-collaborative-llms">codes</a>
        /
        <a href="https://arxiv.org/abs/2404.09753">arXiv</a>
        <div class="keywords">
          <span class="keyword-tag">Collaborative Learning</span>
          <span class="keyword-tag">Personalization</span>
          <span class="keyword-tag">On-Device</span>
          <span class="keyword-tag">Fine-Tuning</span>
        </div>
        <p></p>
        <!-- <p>
          <li> Logits are more effective in collaborator selection than gradients in language modeling </li>
          <li> A better understanding of statistical heterogeneity in language data is needed.  </li>
        </p> -->
      </td>
    </tr>


    <tr>
      <td style="padding:16px;width:20%;vertical-align:middle">
        <div class="conference-container">
          <span class="conference-tag">AAAI 2024</span>
        </div>
        <!-- <div class="one"> -->
          <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
          <img src='images/ghost_noise.png' width=100%>
        </div>
      </td>
      <td style="padding:8px;width:80%;vertical-align:middle">
          <span class="papertitle">Ghost Noise for Regularizing Deep Neural Networks
          </span>
        </a>
        <br>
				
        <a href="https://www.kosson.is/">Atli Kosson</a>,
				<strong>Dongyang Fan</strong>,
        Martin Jaggi
        <br>
        <a href="https://arxiv.org/abs/2305.17205">arXiv</a>
        <div class="keywords">
          <span class="keyword-tag">Regularization</span>
          <span class="keyword-tag">Deep Learning</span>
          <span class="keyword-tag">Generalization</span>
        </div>
        <p></p>
        <!-- <p>
        <li>We propose a novel regularizer--ghost noise, that can improve the generalization of DNNs </li>  
        <li>Ghost noise can be applied to noise-free layer-normalized networks.</li>
        </p> -->
      </td>
    </tr>


    <tr bgcolor="#ffffd0">
      <td style="padding:16px;width:20%;vertical-align:middle">
        <div class="conference-container">
          <span class="conference-tag">NeurIPS 2023</span>
        </div>
        <!-- <div class="one"> -->
          <div style="display: flex; align-items: center; justify-content: center; height: 100%;"></div>
          <img src='images/collab-consensus.png' width=100%>
        </div>
      </td>
      <td style="padding:8px;width:80%;vertical-align:middle">
          <span class="papertitle">Collaborative Learning via Prediction Consensus
          </span>
        </a>
        <br>
				<strong>Dongyang Fan</strong>,
        <a href="https://celestine.ai/">Celestine Mendler-D√ºnner</a>,
        Martin Jaggi
        <br>
        <a href="https://github.com/fan1dy/collaboration-consensus">codes</a>
        /
        <a href="https://arxiv.org/abs/2305.18497">arXiv</a>
        /
        <a href="https://drive.google.com/file/d/1p4QdvqdFaxWc40baEhVN-diXANpYFVcV/view?usp=sharing">poster</a>
        <div class="keywords">
          <span class="keyword-tag">Collaborative Learning</span>
          <span class="keyword-tag">Consensus</span>
          <span class="keyword-tag">Knowledge Distillation</span>
        </div>
        <p></p>
        <!-- <p>
          <li>We propose a novel co-distillation method based on consensus reaching</li>
          <li>Models iteratively determining labels on the target data can be modeled by a Markov Process</li> 
        </p> -->
      </td>
    </tr>

 </tbody></table>
  <table style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;"><tbody>
      <tr>
      <td style="padding:16px;width:100%;vertical-align:middle">
        <h2>Academic Service</h2>
        <ul>
        <li>
         Reviewer for NeurIPS 2025 (Top Reviewer ‚≠êÔ∏è), 2024; ICLR 2025, 2023; COLM 2025 and multiple workshops.
        </li>
         <li>
        Supervison of student projects: My supervised student projects have resulted in a COLM paper and an oral presentation at a COLM workshop.
         </li>
         </ul>
      </td>
    </tr>

  </tbody></table>
  <table style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;"><tbody>
      <tr>
      <td style="padding:16px;width:100%;vertical-align:middle">
        <h2>Miscellaneous</h2>
        <p>
         In general I like arts and cultural stuff. I am also an outdoorsy person and I do hiking skiing and sailing. 
        </p>
        <p>
        I paint from my hiking trips. For example... 
        </p>
        <style>
          .grid-container {
              display: grid;
              grid-template-columns: repeat(2, 1fr); /* Two columns */
              gap: 20px; /* Space between figures */
              text-align: center;
          }
          img {
              width: 100%;
              max-width: 300px;
              height: auto;
          }
      </style>
        <div class="grid-container">
          <figure>
              <img src="images/bridge.jpeg" alt="Figure 1" >
              <figcaption></figcaption>
          </figure>
          <figure>
              <img src="images/grimentz.png" alt="Figure 2" >
              <figcaption></figcaption>
          </figure>
      </div>
      
      </td>
    </tr>
  </tbody></table>
  <table style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;"><tbody>


            
          </tbody></table>
          <table style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;"><tbody>
            <tr>
              <td style="padding:0px">
                <br>
                <p style="text-align:right;font-size:small;">
                  Source codes of the website are from <a href="https://github.com/jonbarron/jonbarron_website">here</a>. 
                </p>
              </td>
            </tr>
          </tbody></table>
        </td>
      </tr>
    </table>
  <script>
    // Theme management with time-based automatic switching
    (function() {
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      const html = document.documentElement;
      
      // Determine if it's day or night based on local time
      // Day: 6 AM - 8 PM (6:00 - 20:00)
      // Night: 8 PM - 6 AM (20:00 - 6:00)
      function isDayTime() {
        const now = new Date();
        const hour = now.getHours();
        return hour >= 6 && hour < 20;
      }
      
      // Get theme based on time of day
      function getTimeBasedTheme() {
        return isDayTime() ? 'light' : 'dark';
      }
      
      // Check if user has manually set a preference
      function hasManualOverride() {
        return localStorage.getItem('theme') !== null;
      }
      
      // Get saved theme preference
      const savedTheme = localStorage.getItem('theme');
      
      // Set initial theme
      if (savedTheme) {
        // User has manually set a preference, use it
        html.setAttribute('data-theme', savedTheme);
      } else {
        // No manual preference, use time-based theme
        const timeBasedTheme = getTimeBasedTheme();
        html.setAttribute('data-theme', timeBasedTheme);
      }
      
      // Update icon
      function updateIcon() {
        const currentTheme = html.getAttribute('data-theme');
        themeIcon.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      }
      updateIcon();
      
      // Toggle theme (manual override)
      themeToggle.addEventListener('click', () => {
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme); // Save manual preference
        updateIcon();
      });
      
      // Check time periodically and update theme if no manual override
      // Check every minute to catch day/night transitions
      setInterval(() => {
        if (!hasManualOverride()) {
          const timeBasedTheme = getTimeBasedTheme();
          const currentTheme = html.getAttribute('data-theme');
          if (currentTheme !== timeBasedTheme) {
            html.setAttribute('data-theme', timeBasedTheme);
            updateIcon();
          }
        }
      }, 60000); // Check every minute
      
      // Also check when page becomes visible again (user returns to tab)
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden && !hasManualOverride()) {
          const timeBasedTheme = getTimeBasedTheme();
          html.setAttribute('data-theme', timeBasedTheme);
          updateIcon();
        }
      });
    })();
  </script>
  </body>
</html>
